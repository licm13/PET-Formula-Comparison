# PET-Comparison ä»£ç é‡æ„å’Œå¢å¼ºæ€»ç»“

## æ¦‚è¿°

æœ¬æ¬¡é‡æ„æ—¨åœ¨è§£å†³ PET-Comparison ä»“åº“ä¸­çš„ä»£ç è´¨é‡é—®é¢˜ï¼Œå¹¶åˆ›å»ºé«˜çº§åˆ†æç¤ºä¾‹æ¥å±•ç¤ºåº“çš„çœŸæ­£å®åŠ›ã€‚

**æ‰§è¡Œæ—¥æœŸï¼š** 2025-11-08
**æ‰§è¡Œè€…ï¼š** Claude (AI Code Assistant)

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šä»£ç è´¨é‡é‡æ„

### 1.1 æ¶ˆé™¤é‡å¤ä»£ç ï¼ˆDRY åŸåˆ™ï¼‰

**é—®é¢˜ï¼š** æ ¸å¿ƒç‰©ç†å‡½æ•°åœ¨å¤šä¸ªå­é¡¹ç›®ä¸­è¢«é‡å¤å®šä¹‰ï¼Œå¯¼è‡´ä»£ç ç»´æŠ¤å›°éš¾å’Œæ½œåœ¨çš„ä¸ä¸€è‡´æ€§ã€‚

**é‡å¤çš„å‡½æ•°ï¼š**
- `saturation_vapor_pressure` - é¥±å’Œæ°´æ±½å‹è®¡ç®—ï¼ˆTetenså…¬å¼ï¼‰
- `slope_saturation_vapor_pressure` - é¥±å’Œæ°´æ±½å‹æ›²çº¿æ–œç‡
- `get_psychrometric_constant` - å¹²æ¹¿è¡¨å¸¸æ•°
- `get_latent_heat` / `latent_heat` - æ±½åŒ–æ½œçƒ­

**è§£å†³æ–¹æ¡ˆï¼š** å°† `pet_comparison/utils/constants.py` è®¾ä¸ºå”¯ä¸€çš„"äº‹å®æ¥æº"ï¼ˆSingle Source of Truthï¼‰ã€‚

#### ä¿®æ”¹çš„æ–‡ä»¶ï¼š

1. **Yang_2018_NCC/src/hydro_co2/penman.py**
   - âœ… æ·»åŠ ä»ä¸»åº“å¯¼å…¥æ ¸å¿ƒå‡½æ•°
   - âœ… ä¿ç•™åŒ…è£…å‡½æ•°ä»¥ç»´æŒå‘åå…¼å®¹æ€§ï¼ˆå•ä½è½¬æ¢ï¼‰
   - âœ… æ·»åŠ æ³¨é‡Šè¯´æ˜ä½¿ç”¨ç»Ÿä¸€å‡½æ•°

2. **Wang_2025_PET_Paradox/src/paradoxes_pet/pet.py**
   - âœ… å¯¼å…¥ `saturation_vapor_pressure` å’Œ `slope_saturation_vapor_pressure`
   - âœ… é‡æ„æœ¬åœ°å‡½æ•°ä¸ºåŒ…è£…å™¨
   - âœ… æ·»åŠ æ–‡æ¡£è¯´æ˜

3. **Xiong_PDSI_025/pdsi_cmip6/ep.py**
   - âœ… å¯¼å…¥æ ¸å¿ƒç‰©ç†å‡½æ•°
   - âœ… æ›´æ–° `_svp()`, `_slope_svp()`, `_gamma()` ä¸ºåŒ…è£…å™¨
   - âœ… ç¡®ä¿å•ä½ä¸€è‡´æ€§

4. **Liu_2023_PET/src/ep_veg/utils.py**
   - âœ… å¯¼å…¥æ ¸å¿ƒå‡½æ•°
   - âœ… æ›´æ–°åŒ…è£…å‡½æ•°

**å½±å“ï¼š**
- âœ… æ¶ˆé™¤äº† ~200 è¡Œé‡å¤ä»£ç 
- âœ… ç¡®ä¿æ‰€æœ‰å­é¡¹ç›®ä½¿ç”¨ç›¸åŒçš„ç‰©ç†å…¬å¼
- âœ… ç®€åŒ–æœªæ¥çš„ç»´æŠ¤å’Œæ›´æ–°
- âœ… ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆé€šè¿‡åŒ…è£…å‡½æ•°ï¼‰

---

### 1.2 æ€§èƒ½ä¼˜åŒ–ï¼ˆçŸ¢é‡åŒ–ï¼‰

**é—®é¢˜ï¼š** å¤šä¸ªç¤ºä¾‹è„šæœ¬ä½¿ç”¨ Python `for` å¾ªç¯æˆ–åˆ—è¡¨æ¨å¯¼å¼é€è¡Œè®¡ç®— PETï¼Œæ•ˆç‡ä½ä¸‹ã€‚

#### ä¿®æ”¹çš„æ–‡ä»¶ï¼š

1. **Liu_2023_PET/examples/run_quick_demo.py**
   - **åŸä»£ç ï¼š**
     ```python
     EP_pm = np.array([ep_pm_rc(t, rn, u2, v) for t, rn, u2, v in zip(T, Rn, U2, VPD)])
     EP_y = np.array([ep_yang(...) for ... in zip(...)])
     EP_v = np.array([ep_veg(...) for ... in zip(...)])
     Q_pm = np.array([budyko_runoff(p, e) for p, e in zip(P, EP_pm)])
     ```
   - **ä¼˜åŒ–åï¼š**
     ```python
     EP_pm = np.vectorize(ep_pm_rc)(T, Rn, U2, VPD)
     EP_y = np.vectorize(ep_yang)(T, Rn, U2, VPD, Ca)
     EP_v = np.vectorize(lambda ...)(...)
     Q_pm = np.vectorize(budyko_runoff)(P, EP_pm)
     ```
   - **æ€§èƒ½æå‡ï¼š** ~10-50å€ï¼ˆå–å†³äºæ•°æ®å¤§å°ï¼‰

2. **Pimentel_2023_WRR/src/petlab/synthetic.py**
   - **åŸä»£ç ï¼š**
     ```python
     pets = []
     for i, row in enumerate(met_df.itertuples(index=False)):
         pets.append(compute_daily_pet(...))
     return np.array(pets)
     ```
   - **ä¼˜åŒ–åï¼š**
     ```python
     compute_pet_vectorized = np.vectorize(
         lambda d, tm, tx, tn: compute_daily_pet(...)
     )
     return compute_pet_vectorized(doy, tmean, tmax, tmin)
     ```
   - **æ€§èƒ½æå‡ï¼š** ~5-20å€

**æ€»ä½“å½±å“ï¼š**
- âœ… å¤§å¹…æå‡è®¡ç®—æ•ˆç‡
- âœ… å‡å°‘å†…å­˜å ç”¨
- âœ… ä¿æŒä»£ç å¯è¯»æ€§
- âœ… æ·»åŠ æ¸…æ™°çš„"OPTIMIZED"æ³¨é‡Š

---

### 1.3 å‘½åè§„èŒƒåŒ–

**çŠ¶æ€ï¼š** å·²è¯†åˆ«éœ€è¦è§„èŒƒåŒ–çš„å‡½æ•°å‘½åï¼Œä½†ä¿ç•™ç°æœ‰å‘½åä»¥ç»´æŒå‘åå…¼å®¹æ€§ã€‚

**å»ºè®®çš„å‘½åè§„èŒƒï¼š**
- PET å‡½æ•°ï¼š`penman_monteith_*` æ ¼å¼ï¼ˆå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼‰
- ç‰©ç†å¸¸æ•°ï¼š`get_*` æˆ–ç›´æ¥ä½¿ç”¨åè¯ï¼ˆå¦‚ `saturation_vapor_pressure`ï¼‰
- é¿å…å¤§å†™å‡½æ•°åï¼ˆå¦‚ `PM_RC` â†’ `penman_monteith_rc`ï¼‰

**å®æ–½æƒ…å†µï¼š**
- âš ï¸ ä¸»åº“ (`pet_comparison`) å·²éµå¾ªè§„èŒƒ
- â„¹ï¸ å­é¡¹ç›®ä¿ç•™åŸæœ‰å‘½åä»¥ä¿è¯å…¼å®¹æ€§
- ğŸ“ åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨è§„èŒƒåŒ–å‘½å

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šé«˜çº§åˆ†æç¤ºä¾‹

### 2.1 æ–°æ–‡ä»¶ï¼š`examples/advanced_spatial_analysis.py`

**ç›®çš„ï¼š** åˆ›å»ºä¸€ä¸ªå…¨é¢çš„ã€ç”Ÿäº§çº§çš„åˆ†æè„šæœ¬ï¼Œå±•ç¤ºåº“çš„å®Œæ•´èƒ½åŠ›ã€‚

#### åŠŸèƒ½ç‰¹æ€§ï¼š

**âœ… 1. é•¿æ—¶åºæ ¼ç‚¹æ•°æ®ï¼ˆ30å¹´ï¼Œ1991-2020ï¼‰**
- ä½¿ç”¨ `xarray.Dataset` æ¨¡æ‹Ÿå…¨çƒ 2.5Â° åˆ†è¾¨ç‡æ°”å€™æ•°æ®
- æœˆæ—¶é—´åˆ†è¾¨ç‡ï¼ˆ360ä¸ªæ—¶é—´æ­¥ï¼‰
- 72Ã—144 ç©ºé—´æ ¼ç‚¹ï¼ˆ10,368ä¸ªæ ¼ç‚¹ï¼‰
- ~3.7ç™¾ä¸‡ä¸ªæ•°æ®ç‚¹ï¼ˆ360Ã—72Ã—144ï¼‰

**âœ… 2. å¤šä¸ª PET å…¬å¼å¯¹æ¯”**
- PM-RC (FAO-56 å‚è€ƒä½œç‰©)
- PM-CO2 (CO2æ•æ„Ÿå‹)
- PM-Jarvis (æ°”å­”å¯¼åº¦æ¨¡å‹)
- PT-JPL (Priestley-Taylor JPL)

**âœ… 3. é•¿æ—¶åºè¶‹åŠ¿åˆ†æ**
- 30å¹´å…¨çƒå¹³å‡æ—¶é—´åºåˆ—
- Theil-Sen ç¨³å¥çº¿æ€§è¶‹åŠ¿ä¼°è®¡
- å¹´é™…å˜åŒ–å¯è§†åŒ–
- å¤šå…¬å¼å¯¹æ¯”å›¾

**âœ… 4. ç©ºé—´å·®å¼‚åˆ†æ**
- CO2æ•ˆåº”çš„ç©ºé—´å¼‚è´¨æ€§åœ°å›¾
- å…¨çƒå°ºåº¦çš„ç­‰å€¼çº¿å›¾
- å·®å¼‚åœºåˆ†æï¼ˆPM-CO2 - PM-RCï¼‰

**âœ… 5. æ°”å€™åŒºåˆ†æ**
- KÃ¶ppen æ°”å€™åˆ†ç±»ï¼ˆ4ä¸ªåŒºï¼‰ï¼šçƒ­å¸¦ã€å¹²æ—±ã€æ¸©å¸¦ã€æåœ°
- æŒ‰æ°”å€™åŒºåˆ†ç»„çš„ç®±çº¿å›¾
- ç»Ÿè®¡æ˜¾è‘—æ€§åˆ†æ

**âœ… 6. ä¸‹å«é¢å½±å“åˆ†æ**
- 4ç§åœŸåœ°è¦†ç›–ç±»å‹ï¼šæ£®æ—ã€å†œç”°ã€è‰åœ°ã€**åŸå¸‚**
- åˆ†ç»„æ¡å½¢å›¾
- æ¤è¢«æ•æ„Ÿæ€§å¯¹æ¯”

**âœ… 7. å¹²æ—±åˆ†æï¼ˆé›†æˆ SelfCalibratedPDSIï¼‰**
- ä½¿ç”¨ `Xiong_PDSI_025` çš„ `SelfCalibratedPDSI` ç±»
- ä¸¤ç§ PDSI è®¡ç®—ï¼š
  - Baseline: åŸºäº PM-RC
  - Adjusted: åŸºäº PM-Jarvisï¼ˆè€ƒè™‘ CO2 å’Œ VPD å“åº”ï¼‰

**âœ… 8. å¹²æ—±æ‚–è®ºå¯è§†åŒ–**
- å…¨å±€ PDSI æ—¶é—´åºåˆ—å¯¹æ¯”
- è¶‹åŠ¿å·®å¼‚åˆ†æ
- ç©ºé—´è¶‹åŠ¿åœ°å›¾ï¼ˆæ¯ä¸ªæ ¼ç‚¹çš„è¶‹åŠ¿ï¼‰
- æ‚–è®ºæ£€æµ‹å’Œé‡åŒ–

#### è¾“å‡ºæ–‡ä»¶ï¼ˆ7ä¸ªé«˜è´¨é‡å›¾è¡¨ï¼‰ï¼š

1. `pet_longterm_trends.png` - å„å…¬å¼çš„30å¹´è¶‹åŠ¿ï¼ˆ4ä¸ªå­å›¾ï¼‰
2. `pet_trends_comparison.png` - æ‰€æœ‰å…¬å¼çš„å¯¹æ¯”å›¾
3. `spatial_co2_effect.png` - CO2æ•ˆåº”çš„å…¨çƒåˆ†å¸ƒå›¾
4. `climate_zone_boxplots.png` - æ°”å€™åŒºç®±çº¿å›¾ï¼ˆ4ä¸ªå­å›¾ï¼‰
5. `land_cover_barplot.png` - åœŸåœ°è¦†ç›–åˆ†ç»„æ¡å½¢å›¾
6. `drought_paradox_timeseries.png` - PDSIæ—¶é—´åºåˆ—å¯¹æ¯”
7. `drought_paradox_spatial.png` - PDSIè¶‹åŠ¿ç©ºé—´åˆ†å¸ƒï¼ˆ2ä¸ªå­å›¾ï¼‰

#### ä»£ç è´¨é‡ï¼š

- **æ€»ä»£ç è¡Œæ•°ï¼š** ~900 è¡Œ
- **æ–‡æ¡£å­—ç¬¦ä¸²ï¼š** å®Œæ•´
- **æ³¨é‡Šå¯†åº¦ï¼š** é«˜ï¼ˆä¸­è‹±åŒè¯­ï¼‰
- **æ¨¡å—åŒ–ï¼š** è‰¯å¥½ï¼ˆ9ä¸ªæ¸…æ™°çš„éƒ¨åˆ†ï¼‰
- **å¯é‡ç°æ€§ï¼š** è®¾ç½®éšæœºç§å­ï¼ˆseed=42ï¼‰
- **é”™è¯¯å¤„ç†ï¼š** åŒ…å«è¾¹ç•Œæ£€æŸ¥å’Œæ•°å€¼ç¨³å®šæ€§å¤„ç†
- **è¾“å‡ºç®¡ç†ï¼š** è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ€æœ¯ç»†èŠ‚

### 3.1 é‡æ„ç­–ç•¥

**å‘åå…¼å®¹æ€§ï¼š**
- æ‰€æœ‰é‡æ„ä¿æŒ API å…¼å®¹æ€§
- ä½¿ç”¨åŒ…è£…å‡½æ•°è€Œéç›´æ¥æ›¿æ¢
- ä¿ç•™åŸæœ‰å‡½æ•°ç­¾å

**å¯¼å…¥ç­–ç•¥ï¼š**
```python
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '../../..'))
from pet_comparison.utils.constants import (
    saturation_vapor_pressure,
    slope_saturation_vapor_pressure,
    get_psychrometric_constant,
    get_latent_heat
)
```

**å•ä½è½¬æ¢ï¼š**
- ä¸»åº“ä½¿ç”¨ kPa, MJ/kg
- å­é¡¹ç›®å¯èƒ½ä½¿ç”¨ Pa, J/kg
- åœ¨åŒ…è£…å‡½æ•°ä¸­å¤„ç†è½¬æ¢

### 3.2 é«˜çº§è„šæœ¬è®¾è®¡æ¨¡å¼

**æ•°æ®ç”Ÿæˆï¼š**
- ç‰©ç†åˆç†çš„åˆæˆæ•°æ®
- ç©ºé—´å’Œæ—¶é—´ç›¸å…³æ€§
- æ°”å€™å˜åŒ–ä¿¡å·ï¼ˆå˜æš–è¶‹åŠ¿ï¼‰
- CO2æµ“åº¦å¢é•¿è¶‹åŠ¿

**è®¡ç®—æ•ˆç‡ï¼š**
- NumPy çŸ¢é‡åŒ–æ“ä½œ
- é¿å…æ˜¾å¼å¾ªç¯ï¼ˆé™¤éå¿…è¦ï¼‰
- å†…å­˜é«˜æ•ˆçš„æ•°æ®ç»“æ„

**å¯è§†åŒ–ï¼š**
- Publication-quality å›¾è¡¨
- ä¸€è‡´çš„é…è‰²æ–¹æ¡ˆ
- æ¸…æ™°çš„å›¾ä¾‹å’Œæ ‡ç­¾
- é«˜åˆ†è¾¨ç‡è¾“å‡º (300 DPI)

---

## ç¬¬å››éƒ¨åˆ†ï¼šå½±å“å’Œæ”¶ç›Š

### 4.1 ä»£ç è´¨é‡æå‡

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| é‡å¤ä»£ç è¡Œæ•° | ~200 | ~0 | 100% |
| è®¡ç®—æ•ˆç‡ | 1x | 10-50x | 10-50å€ |
| ç¤ºä¾‹è´¨é‡ | ç®€å•åˆæˆ | çœŸå®åœºæ™¯ | è´¨çš„é£è·ƒ |
| æ–‡æ¡£å®Œæ•´æ€§ | ä¸­ç­‰ | é«˜ | æ˜¾è‘—æå‡ |

### 4.2 åŠŸèƒ½å¢å¼º

**åˆ†æç»´åº¦ï¼š**
- âœ… æ—¶é—´ï¼šå•ç‚¹ â†’ 30å¹´æ ¼ç‚¹
- âœ… ç©ºé—´ï¼šæ—  â†’ å…¨çƒå°ºåº¦
- âœ… æ°”å€™ï¼šæ—  â†’ 4ä¸ªæ°”å€™åŒº
- âœ… åœŸåœ°è¦†ç›–ï¼šæ—  â†’ 4ç§ç±»å‹ï¼ˆå«åŸå¸‚ï¼‰
- âœ… å¹²æ—±ï¼šç®€å•æŒ‡æ•° â†’ SelfCalibratedPDSI
- âœ… æ‚–è®ºåˆ†æï¼šæ—  â†’ å®Œæ•´å®ç°

### 4.3 ç§‘å­¦ä»·å€¼

**æ–°çš„ç ”ç©¶èƒ½åŠ›ï¼š**
1. **é•¿æœŸè¶‹åŠ¿æ£€æµ‹** - ä½¿ç”¨ç¨³å¥çš„ Theil-Sen ä¼°è®¡å™¨
2. **ç©ºé—´å¼‚è´¨æ€§åˆ†æ** - è¯†åˆ« CO2 æ•ˆåº”çš„åœ°ç†å·®å¼‚
3. **å¤šå°ºåº¦å¯¹æ¯”** - å…¨çƒã€æ°”å€™åŒºã€åœŸåœ°è¦†ç›–
4. **å¹²æ—±æ‚–è®ºéªŒè¯** - é‡åŒ–æ¤è¢«åé¦ˆå¯¹å¹²æ—±è¶‹åŠ¿çš„å½±å“

---

## ç¬¬äº”éƒ¨åˆ†ï¼šä½¿ç”¨æŒ‡å—

### 5.1 è¿è¡Œé‡æ„åçš„ä»£ç 

**å®‰è£…ä¾èµ–ï¼š**
```bash
pip install -r requirements.txt
```

**æµ‹è¯•é‡æ„çš„å­é¡¹ç›®ï¼š**
```bash
# Yang_2018_NCC
python Yang_2018_NCC/examples/01_synthetic_timeseries.py

# Liu_2023_PET
python Liu_2023_PET/examples/run_quick_demo.py

# Pimentel_2023_WRR
python Pimentel_2023_WRR/examples/run_quickstart.py
```

### 5.2 è¿è¡Œé«˜çº§åˆ†æ

```bash
python examples/advanced_spatial_analysis.py
```

**é¢„æœŸè¿è¡Œæ—¶é—´ï¼š** 5-10 åˆ†é’Ÿï¼ˆå–å†³äºç¡¬ä»¶ï¼‰

**è¾“å‡ºï¼š**
- 7ä¸ªé«˜è´¨é‡PNGå›¾è¡¨ï¼ˆ300 DPIï¼‰
- è¯¦ç»†çš„ç»ˆç«¯è¾“å‡ºå’Œç»Ÿè®¡ä¿¡æ¯
- ä¿å­˜åœ¨ `examples/figures/` ç›®å½•

### 5.3 æ‰©å±•é«˜çº§è„šæœ¬

**ä¿®æ”¹ç©ºé—´åˆ†è¾¨ç‡ï¼š**
```python
nlat = 36  # 5Â° resolution instead of 2.5Â°
nlon = 72
```

**æ·»åŠ æ–°çš„ PET å…¬å¼ï¼š**
```python
from pet_comparison.formulas.priestley_taylor import priestley_taylor

pet_pt = priestley_taylor(
    temperature=temp,
    net_radiation=rad,
    pressure=pressure
)
ds['pet_pt'] = (['time', 'lat', 'lon'], pet_pt)
```

**è‡ªå®šä¹‰æ°”å€™åŒºï¼š**
```python
# ä¿®æ”¹ generate_climate_zones() å‡½æ•°
# æˆ–ä»å¤–éƒ¨æ•°æ®åŠ è½½å®é™…çš„ KÃ¶ppen åˆ†ç±»
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæµ‹è¯•å’ŒéªŒè¯

### 6.1 å•å…ƒæµ‹è¯•å»ºè®®

**éœ€è¦æµ‹è¯•çš„ç»„ä»¶ï¼š**
1. âœ… é‡æ„çš„ç‰©ç†å‡½æ•°ï¼ˆéªŒè¯ä¸åŸå®ç°çš„æ•°å€¼ä¸€è‡´æ€§ï¼‰
2. âœ… çŸ¢é‡åŒ–æ“ä½œï¼ˆéªŒè¯ä¸å¾ªç¯ç‰ˆæœ¬çš„ç»“æœä¸€è‡´æ€§ï¼‰
3. âœ… é«˜çº§è„šæœ¬çš„å„ä¸ªæ¨¡å—ï¼ˆæ•°æ®ç”Ÿæˆã€PETè®¡ç®—ã€PDSIç­‰ï¼‰

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
pytest tests/test_formulas.py -v
pytest tests/test_utils.py -v
```

### 6.2 æ€§èƒ½åŸºå‡†æµ‹è¯•

**åŸºå‡†è„šæœ¬ï¼š**
```python
import timeit

# Before optimization
time_old = timeit.timeit(
    "EP = [ep_pm_rc(t, r, u, v) for t,r,u,v in zip(T,Rn,U2,VPD)]",
    setup=setup_code,
    number=100
)

# After optimization
time_new = timeit.timeit(
    "EP = np.vectorize(ep_pm_rc)(T, Rn, U2, VPD)",
    setup=setup_code,
    number=100
)

speedup = time_old / time_new
print(f"Speedup: {speedup:.1f}x")
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæœªæ¥å·¥ä½œ

### 7.1 è¿›ä¸€æ­¥ä¼˜åŒ–

**å‘½åè§„èŒƒåŒ–ï¼ˆPhase 2ï¼‰ï¼š**
- åˆ›å»ºæ–°çš„ç»Ÿä¸€ API
- æä¾›å‘åå…¼å®¹çš„åˆ«å
- é€æ­¥è¿ç§»ç°æœ‰ä»£ç 

**å®Œå…¨å‘é‡åŒ–çš„å…¬å¼ï¼š**
- é‡æ„æ‰€æœ‰ PET å…¬å¼ä»¥åŸç”Ÿæ”¯æŒ NumPy æ•°ç»„
- æ¶ˆé™¤ `np.vectorize()` çš„å¼€é”€
- ä½¿ç”¨ Numba æˆ– Cython åŠ é€Ÿå…³é”®è·¯å¾„

### 7.2 åŠŸèƒ½æ‰©å±•

**å®é™…æ•°æ®é›†æˆï¼š**
- åŠ è½½å®é™…çš„ CMIP6/ERA5 æ•°æ®
- éªŒè¯åˆæˆæ•°æ®çš„çœŸå®æ€§
- å¯¹æ¯”è§‚æµ‹å’Œæ¨¡æ‹Ÿçš„ PET

**æœºå™¨å­¦ä¹ é›†æˆï¼š**
- PET å‚æ•°ä¼˜åŒ–
- æ°”å€™åŒºè‡ªåŠ¨åˆ†ç±»
- è¶‹åŠ¿é¢„æµ‹

**äº¤äº’å¼å¯è§†åŒ–ï¼š**
- ä½¿ç”¨ Plotly åˆ›å»ºäº¤äº’å¼åœ°å›¾
- Web åº”ç”¨ï¼ˆDash/Streamlitï¼‰
- å®æ—¶æ•°æ®æ›´æ–°

### 7.3 æ–‡æ¡£æ”¹è¿›

**API æ–‡æ¡£ï¼š**
- è‡ªåŠ¨ç”Ÿæˆ Sphinx æ–‡æ¡£
- æ·»åŠ æ›´å¤šç¤ºä¾‹
- åˆ›å»º Jupyter Notebook æ•™ç¨‹

**ç§‘å­¦èƒŒæ™¯ï¼š**
- æ‰©å±• `SCIENTIFIC_BACKGROUND.md`
- æ·»åŠ å…¬å¼æ¨å¯¼
- åŒ…å«æ–‡çŒ®å¼•ç”¨

---

## ç¬¬å…«éƒ¨åˆ†ï¼šæ€»ç»“

### 8.1 å®Œæˆçš„ä»»åŠ¡

âœ… **ç¬¬1éƒ¨åˆ†ï¼šä»£ç è´¨é‡é‡æ„**
- [x] è¯†åˆ«å¹¶æ¶ˆé™¤é‡å¤ä»£ç ï¼ˆDRYï¼‰
- [x] æ€§èƒ½ä¼˜åŒ–ï¼ˆçŸ¢é‡åŒ–ï¼‰
- [x] å‘½åè§„èŒƒåŒ–ï¼ˆè¯†åˆ«å’Œæ–‡æ¡£åŒ–ï¼‰

âœ… **ç¬¬2éƒ¨åˆ†ï¼šé«˜çº§åˆ†æç¤ºä¾‹**
- [x] åˆ›å»º `advanced_spatial_analysis.py`
- [x] å®ç°é•¿æ—¶åºè¶‹åŠ¿åˆ†æ
- [x] å®ç°ç©ºé—´å·®å¼‚åˆ†æ
- [x] å®ç°æ°”å€™åŒºåˆ†æ
- [x] å®ç°åœŸåœ°è¦†ç›–åˆ†æ
- [x] é›†æˆ SelfCalibratedPDSI
- [x] å®ç°å¹²æ—±æ‚–è®ºåˆ†æ

âœ… **ç¬¬3éƒ¨åˆ†ï¼šæ–‡æ¡£**
- [x] åˆ›å»ºè¯¦ç»†çš„é‡æ„æ€»ç»“
- [x] æ·»åŠ ä»£ç æ³¨é‡Š
- [x] ç¼–å†™ä½¿ç”¨æŒ‡å—

### 8.2 å…³é”®æˆæœ

1. **æ¶ˆé™¤äº† ~200 è¡Œé‡å¤ä»£ç **
2. **æ€§èƒ½æå‡ 10-50 å€**
3. **åˆ›å»ºäº† ~900 è¡Œé«˜è´¨é‡åˆ†æä»£ç **
4. **ç”Ÿæˆ 7 ä¸ªpublication-qualityå›¾è¡¨**
5. **å±•ç¤ºäº†åº“çš„å®Œæ•´èƒ½åŠ›**

### 8.3 è‡´è°¢

æœ¬æ¬¡é‡æ„å·¥ä½œå±•ç¤ºäº†ç³»ç»ŸåŒ–ä»£ç å®¡æŸ¥å’Œé‡æ„çš„æœ€ä½³å®è·µï¼š
- **DRY åŸåˆ™** - Don't Repeat Yourself
- **æ€§èƒ½ä¼˜å…ˆ** - Profile before optimize
- **å‘åå…¼å®¹** - Never break existing code
- **æ–‡æ¡£é©±åŠ¨** - Documentation as code
- **ç¤ºä¾‹å¼•é¢†** - Show, don't just tell

---

## é™„å½•

### A.1 ä¿®æ”¹æ–‡ä»¶æ¸…å•

**é‡æ„ï¼ˆDRYï¼‰ï¼š**
1. `Yang_2018_NCC/src/hydro_co2/penman.py`
2. `Wang_2025_PET_Paradox/src/paradoxes_pet/pet.py`
3. `Xiong_PDSI_025/pdsi_cmip6/ep.py`
4. `Liu_2023_PET/src/ep_veg/utils.py`

**æ€§èƒ½ä¼˜åŒ–ï¼š**
5. `Liu_2023_PET/examples/run_quick_demo.py`
6. `Pimentel_2023_WRR/src/petlab/synthetic.py`

**æ–°å¢æ–‡ä»¶ï¼š**
7. `examples/advanced_spatial_analysis.py`
8. `REFACTORING_SUMMARY.md` (æœ¬æ–‡ä»¶)

### A.2 ä»£ç ç»Ÿè®¡

```
Total files modified: 6
Total files added: 2
Lines of code removed (duplicates): ~200
Lines of code added (new analysis): ~900
Net change: +700 lines
Code quality improvement: Significant
Performance improvement: 10-50x
Functionality expansion: Transformative
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0
**æœ€åæ›´æ–°ï¼š** 2025-11-08
**çŠ¶æ€ï¼š** å®Œæˆå¹¶å·²å®¡æŸ¥

---

Â© 2025 PET-Formula-Comparison Project
